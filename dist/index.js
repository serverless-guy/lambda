"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var __assign=function(){return(__assign=Object.assign||function(e){for(var n,r=1,t=arguments.length;r<t;r++)for(var o in n=arguments[r])Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o]);return e}).apply(this,arguments)};function __awaiter(s,i,a,u){return new(a||(a=Promise))(function(e,n){function r(e){try{o(u.next(e))}catch(e){n(e)}}function t(e){try{o(u.throw(e))}catch(e){n(e)}}function o(n){n.done?e(n.value):new a(function(e){e(n.value)}).then(r,t)}o((u=u.apply(s,i||[])).next())})}function __generator(r,t){var o,s,i,e,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return e={next:n(0),throw:n(1),return:n(2)},"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function n(n){return function(e){return function(n){if(o)throw new TypeError("Generator is already executing.");for(;a;)try{if(o=1,s&&(i=2&n[0]?s.return:n[0]?s.throw||((i=s.return)&&i.call(s),0):s.next)&&!(i=i.call(s,n[1])).done)return i;switch(s=0,i&&(n=[2&n[0],i.value]),n[0]){case 0:case 1:i=n;break;case 4:return a.label++,{value:n[1],done:!1};case 5:a.label++,s=n[1],n=[0];continue;case 7:n=a.ops.pop(),a.trys.pop();continue;default:if(!(i=0<(i=a.trys).length&&i[i.length-1])&&(6===n[0]||2===n[0])){a=0;continue}if(3===n[0]&&(!i||n[1]>i[0]&&n[1]<i[3])){a.label=n[1];break}if(6===n[0]&&a.label<i[1]){a.label=i[1],i=n;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(n);break}i[2]&&a.ops.pop(),a.trys.pop();continue}n=t.call(r,a)}catch(e){n=[6,e],s=0}finally{o=i=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}([n,e])}}}function ok(e,n,r){return void 0===n&&(n=200),void 0===r&&(r={}),{body:JSON.stringify(e),headers:__assign({"Access-Control-Allow-Origin":"*"},r),statusCode:n}}var HTTP_SERVER_ERROR=500;function faulty(e,n){return n({errorCode:e.name,errorMessage:e.message},HTTP_SERVER_ERROR)}function resolveMiddleware(r,t){return void 0===t&&(t=[]),__awaiter(this,void 0,void 0,function(){var i,a,n=this;return __generator(this,function(e){return i=r.event,a=r.context,t.length?[2,t.reduce(function(r,s){return __awaiter(n,void 0,void 0,function(){var o,n=this;return __generator(this,function(e){switch(e.label){case 0:return r?[4,r]:[2,new Promise(function(t,o){return __awaiter(n,void 0,void 0,function(){var n,r;return __generator(this,function(e){switch(e.label){case 0:n={event:i,context:a},e.label=1;case 1:return e.trys.push([1,3,,4]),[4,s(n,t)];case 2:return[2,e.sent()];case 3:return r=e.sent(),[2,o(r)];case 4:return[2]}})})})];case 1:return o=e.sent(),[2,new Promise(function(r,t){return __awaiter(n,void 0,void 0,function(){var n;return __generator(this,function(e){switch(e.label){case 0:return e.trys.push([0,2,,3]),[4,s(o,r)];case 1:return[2,e.sent()];case 2:return n=e.sent(),[2,t(n)];case 3:return[2]}})})})]}})})},void 0)]:[2,{event:i,context:a}]})})}function wrapper(i){var n=this,a={middlewares:[],responseFunction:ok,errorResponseFunction:faulty},e=function(o,s){return __awaiter(n,void 0,void 0,function(){var n,r,t;return __generator(this,function(e){switch(e.label){case 0:n={event:__assign({},o),context:__assign({},s)},e.label=1;case 1:return e.trys.push([1,4,,5]),[4,resolveMiddleware(n,a.middlewares)];case 2:return r=e.sent(),[4,i(r,a.responseFunction)];case 3:return[2,e.sent()];case 4:return t=e.sent(),[2,a.errorResponseFunction(t,a.responseFunction)];case 5:return[2]}})})};return e.setResponseTemplate=function(e){return a.responseFunction=e,n},e.setCatchTemplate=function(e){return a.errorResponseFunction=e,n},e.pushMiddleware=function(e){return a.middlewares.push(e),n},e}exports.wrapper=wrapper;
