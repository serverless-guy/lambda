"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var assertPlus=require("assert-plus"),__assign=function(){return(__assign=Object.assign||function(e){for(var r,t=1,n=arguments.length;t<n;t++)for(var o in r=arguments[t])Object.prototype.hasOwnProperty.call(r,o)&&(e[o]=r[o]);return e}).apply(this,arguments)};function __awaiter(s,a,u,i){return new(u||(u=Promise))(function(e,r){function t(e){try{o(i.next(e))}catch(e){r(e)}}function n(e){try{o(i.throw(e))}catch(e){r(e)}}function o(r){r.done?e(r.value):new u(function(e){e(r.value)}).then(t,n)}o((i=i.apply(s,a||[])).next())})}function __generator(t,n){var o,s,a,e,u={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return e={next:r(0),throw:r(1),return:r(2)},"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function r(r){return function(e){return function(r){if(o)throw new TypeError("Generator is already executing.");for(;u;)try{if(o=1,s&&(a=2&r[0]?s.return:r[0]?s.throw||((a=s.return)&&a.call(s),0):s.next)&&!(a=a.call(s,r[1])).done)return a;switch(s=0,a&&(r=[2&r[0],a.value]),r[0]){case 0:case 1:a=r;break;case 4:return u.label++,{value:r[1],done:!1};case 5:u.label++,s=r[1],r=[0];continue;case 7:r=u.ops.pop(),u.trys.pop();continue;default:if(!(a=0<(a=u.trys).length&&a[a.length-1])&&(6===r[0]||2===r[0])){u=0;continue}if(3===r[0]&&(!a||r[1]>a[0]&&r[1]<a[3])){u.label=r[1];break}if(6===r[0]&&u.label<a[1]){u.label=a[1],a=r;break}if(a&&u.label<a[2]){u.label=a[2],u.ops.push(r);break}a[2]&&u.ops.pop(),u.trys.pop();continue}r=n.call(t,u)}catch(e){r=[6,e],s=0}finally{o=a=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}([r,e])}}}function httpResponser(e){return{body:JSON.stringify(e),headers:{"Access-Control-Allow-Origin":"*"},statusCode:200}}function defaultErrorFunction(e,r){return r({errorCode:e.name,errorMessage:e.message},500)}function resolveBefores(r,n,s){return __awaiter(this,void 0,void 0,function(){var o,t=this;return __generator(this,function(e){switch(e.label){case 0:return o={event:__assign({},r),context:__assign({},n)},s?[4,s.reduce(function(r,n){return __awaiter(t,void 0,void 0,function(){var t;return __generator(this,function(e){switch(e.label){case 0:return r?[4,r]:[2,new Promise(function(e,r){return n(o,e)})];case 1:return t=e.sent(),[2,new Promise(function(e,r){return n(t,e)})]}})})},void 0)]:[2,o];case 1:return[2,e.sent()]}})})}function resolveAfters(t,o){return __awaiter(this,void 0,void 0,function(){var r=this;return __generator(this,function(e){switch(e.label){case 0:return t?[4,t.reduce(function(t,n){return __awaiter(r,void 0,void 0,function(){var r;return __generator(this,function(e){switch(e.label){case 0:return t?[4,t]:[2,new Promise(function(e){return n(o,e)})];case 1:return r=e.sent(),[2,new Promise(function(e){return n(r,e)})]}})})},void 0)]:[2,o];case 1:return[2,e.sent()]}})})}function wrapper(e,s){assertPlus.object(e),assertPlus.optionalArrayOfFunc(e.before),assertPlus.optionalArrayOfFunc(e.after),assertPlus.optionalFunc(e.errorHandler),assertPlus.func(e.handler);var a=e.handler,u=e.before,i=e.after,c=e.errorHandler;return c||(c=defaultErrorFunction),s||(s=httpResponser),function(n,o){return __awaiter(this,void 0,void 0,function(){var r,t;return __generator(this,function(e){switch(e.label){case 0:return e.trys.push([0,2,,3]),[4,resolveBefores(n,o,u)];case 1:return r=e.sent(),[2,a(r,s,function(e){return resolveAfters(i,e)})];case 2:return t=e.sent(),[2,c(t,s)];case 3:return[2]}})})}}exports.wrapper=wrapper;
